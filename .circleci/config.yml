version: 2.1

workflows:
  version: 2
  
  # System 2: 10invisible - Every 4 hours (01:00, 05:00, 09:00... WAT)
  system2-schedule:
    triggers:
      - schedule:
          cron: "0 0,4,8,12,16,20 * * *"
          filters:
            branches:
              only:
                - main
    jobs:
      - trigger-10invisible

  # System 3: 7unreliable - Every 4 hours (03:00, 07:00, 11:00... WAT)
  system3-schedule:
    triggers:
      - schedule:
          cron: "0 2,6,10,14,18,22 * * *"
          filters:
            branches:
              only:
                - main
    jobs:
      - trigger-7unreliable

  # Manual trigger for testing both
  manual-test:
    jobs:
      - trigger-10invisible
      - trigger-7unreliable

jobs:
  trigger-10invisible:
    docker:
      - image: cimg/python:3.10
    steps:
      - checkout
      - run:
          name: Install Kaggle API
          command: pip install kaggle
      - run:
          name: Configure Kaggle Credentials
          command: |
            mkdir -p ~/.kaggle
            echo "{\"username\":\"${KAGGLE_USERNAME}\",\"key\":\"${KAGGLE_KEY}\"}" > ~/.kaggle/kaggle.json
            chmod 600 ~/.kaggle/kaggle.json
      - run:
          name: Create Working Directory
          command: mkdir -p /tmp/kaggle_work
      - run:
          name: Pull 10invisible Notebook
          command: |
            echo "üì• Pulling 10invisible notebook from Kaggle..."
            kaggle kernels pull solomonoffor/10invisible -p /tmp/kaggle_work -f 10invisible.ipynb --force
      - run:
          name: Push to Trigger Execution
          command: |
            echo "üöÄ Pushing 10invisible to trigger execution..."
            cd /tmp/kaggle_work
            kaggle kernels push -p . || echo "‚ö†Ô∏è Push completed (may time out, but notebook should be running)"
          no_output_timeout: 10m
      - run:
          name: Display Success
          command: |
            echo "‚úÖ 10invisible TRIGGERED SUCCESSFULLY!"
            echo "üîó Check status: https://www.kaggle.com/code/solomonoffor/10invisible"
            echo "‚è∞ Next run: 4 hours from now"

  trigger-7unreliable:
    docker:
      - image: cimg/python:3.10
    steps:
      - checkout
      - run:
          name: Install Kaggle API
          command: pip install kaggle
      - run:
          name: Configure Kaggle Credentials
          command: |
            mkdir -p ~/.kaggle
            echo "{\"username\":\"${KAGGLE_USERNAME}\",\"key\":\"${KAGGLE_KEY}\"}" > ~/.kaggle/kaggle.json
            chmod 600 ~/.kaggle/kaggle.json
      - run:
          name: Create Working Directory
          command: mkdir -p /tmp/kaggle_work
      - run:
          name: Pull 7unreliable Notebook
          command: |
            echo "üì• Pulling 7unreliable notebook from Kaggle..."
            kaggle kernels pull solomonoffor/7unreliable -p /tmp/kaggle_work -f 7unreliable.ipynb --force
      - run:
          name: Push to Trigger Execution
          command: |
            echo "üöÄ Pushing 7unreliable to trigger execution..."
            cd /tmp/kaggle_work
            kaggle kernels push -p . || echo "‚ö†Ô∏è Push completed (may time out, but notebook should be running)"
          no_output_timeout: 10m
      - run:
          name: Display Success
          command: |
            echo "‚úÖ 7unreliable TRIGGERED SUCCESSFULLY!"
            echo "üîó Check status: https://www.kaggle.com/code/solomonoffor/7unreliable"
            echo "‚è∞ Next run: 4 hours from now"
