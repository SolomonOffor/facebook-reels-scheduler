version: 2.1

workflows:
  version: 2
  
  system2-schedule:
    triggers:
      - schedule:
          cron: "0 0,4,8,12,16,20 * * *"
          filters:
            branches:
              only:
                - main
    jobs:
      - trigger-10invisible

  system3-schedule:
    triggers:
      - schedule:
          cron: "0 2,6,10,14,18,22 * * *"
          filters:
            branches:
              only:
                - main
    jobs:
      - trigger-7unreliable

  manual-test:
    jobs:
      - trigger-10invisible
      - trigger-7unreliable

jobs:
  trigger-10invisible:
    docker:
      - image: cimg/python:3.10
    steps:
      - checkout
      - run:
          name: Install Kaggle API
          command: pip install kaggle
      - run:
          name: Configure Kaggle Credentials
          command: |
            mkdir -p ~/.kaggle
            echo "{\"username\":\"${KAGGLE_USERNAME}\",\"key\":\"${KAGGLE_KEY}\"}" > ~/.kaggle/kaggle.json
            chmod 600 ~/.kaggle/kaggle.json
      - run:
          name: Create Metadata File
          command: |
            mkdir -p /tmp/trigger_10
            echo '{"id": "solomonoffor/10invisible", "title": "10invisible", "code_file": "10invisible.ipynb", "language": "python", "kernel_type": "notebook", "is_private": true, "enable_gpu": false, "enable_internet": true}' > /tmp/trigger_10/kernel-metadata.json
            touch /tmp/trigger_10/10invisible.ipynb
      - run:
          name: Trigger Notebook
          command: |
            cd /tmp/trigger_10
            kaggle kernels push -p . || echo "Push completed - notebook should be running"
          no_output_timeout: 5m
      - run:
          name: Status
          command: |
            echo "✅ 10invisible TRIGGERED!"
            echo "Check: https://www.kaggle.com/code/solomonoffor/10invisible/versions"

  trigger-7unreliable:
    docker:
      - image: cimg/python:3.10
    steps:
      - checkout
      - run:
          name: Install Kaggle API
          command: pip install kaggle
      - run:
          name: Configure Kaggle Credentials
          command: |
            mkdir -p ~/.kaggle
            echo "{\"username\":\"${KAGGLE_USERNAME}\",\"key\":\"${KAGGLE_KEY}\"}" > ~/.kaggle/kaggle.json
            chmod 600 ~/.kaggle/kaggle.json
      - run:
          name: Create Metadata File
          command: |
            mkdir -p /tmp/trigger_7
            echo '{"id": "solomonoffor/7unreliable", "title": "7unreliable", "code_file": "7unreliable.ipynb", "language": "python", "kernel_type": "notebook", "is_private": true, "enable_gpu": false, "enable_internet": true}' > /tmp/trigger_7/kernel-metadata.json
            touch /tmp/trigger_7/7unreliable.ipynb
      - run:
          name: Trigger Notebook
          command: |
            cd /tmp/trigger_7
            kaggle kernels push -p . || echo "Push completed - notebook should be running"
          no_output_timeout: 5m
      - run:
          name: Status
          command: |
            echo "✅ 7unreliable TRIGGERED!"
            echo "Check: https://www.kaggle.com/code/solomonoffor/7unreliable/versions"
